-- 1. 查出至少有一个员工的部门。显示部门编号、部门名称、部门位置、部门人数。
SELECT t1.`dname`, t2.cou, t1.deptno , t1.loc
FROM t_dept t1, (SELECT COUNT(*) AS cou ,deptno FROM t_employees GROUP BY deptno ) t2
WHERE t1.deptno =t2.deptno AND t2.cou>4
GROUP BY t1.dname

-- 3. 列出所有员工的姓名及其直接上级的姓名
SELECT t1.ename 员工,t2.ename 上级
FROM t_employees t1,t_employees t2
WHERE t1.MGR=t2.empno
ORDER BY 上级 DESC

-- 4. 列出受雇日期早于直接上级的所有员工的编号、姓名、部门名称。
SELECT t1.empno,t1.ename,t3.dname
FROM t_employees t1,t_employees t2,t_dept t3
WHERE t1.MGR=t2.empno AND t1.hiredate<t2.hiredate AND t1.deptno=t3.deptno

-- 5. 列出部门名称和这些部门的员工信息，同时列出那些没有员工的部门
SELECT t1.*,t2.dname
FROM t_employees t1 RIGHT  JOIN t_dept t2 
ON t1.`deptno`=t2.deptno
WHERE t1.`deptno` IS NULL

SELECT t1.*,t2.dname
FROM t_employees t1 JOIN t_dept t2 
ON t1.`deptno`=t2.deptno
WHERE t1.`deptno` IS NULL OR t2.deptno IS NULL

-- 7. 列出最低薪金大于15000的各种工作及从事此工作的员工人数。3000
SELECT job,COUNT(*) 人数
FROM t_employees
WHERE sal>=3000
GROUP BY job

-- 8. 列出在公关部工作的员工的姓名，假定不知道公关部的部门编号。
SELECT ename 
FROM t_employees
WHERE deptno=(SELECT deptno FROM t_dept WHERE dname='公关部')

-- 9. 列出薪金高于公司平均薪金的所有员工信息，所在部门名称，上级领导，工资等级

SELECT t1.* ,t2.dname, t3.ename
FROM t_employees t1, t_dept t2, t_employees t3
WHERE t1.sal>(SELECT AVG(sal) FROM t_employees) AND t1.mgr=t3.empno AND t1.`deptno`=t2.deptno


-- 10.列出与张飞从事相同工作的所有员工及部门名称
SELECT t1.`ename`,t2.dname
FROM t_employees t1, t_dept t2
WHERE t1.job = (SELECT job FROM t_employees WHERE ename='张飞')
AND t1.`deptno`=t2.deptno
AND t1.`ename`<>'张飞'


-- 11.列出薪金高于在部门30工作的所有员工的薪金的员工姓名和薪金、部门名称。
SELECT t1.ename 员工姓名,t1.sal 薪金,  t2.dname 部门名称
FROM t_employees t1,t_dept t2
WHERE t1.sal>(SELECT MAX(sal) FROM t_employees WHERE deptno=30)
AND t1.`deptno`=t2.deptno



